<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªÜ TH·ªêNG V·ªÜ TINH ƒê·ªäA CH√çNH BA V√å 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root { --gold: #FFD700; --red: #ff3e3e; --bg: #000b18; --green: #2ecc71; }
        body { font-family: 'Roboto Mono', monospace; background: var(--bg); color: #fff; margin: 0; padding: 20px; text-align: center; }
        .header { margin-top: 10px; border: 1px solid var(--gold); display: inline-block; padding: 8px 15px; border-radius: 5px; font-size: 11px; }
        .live-dot { height: 8px; width: 8px; background-color: var(--red); border-radius: 50%; display: inline-block; animation: blink 1s infinite; margin-right: 5px; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        
        .search-area { max-width: 500px; margin: 20px auto; }
        input { width: 100%; padding: 15px; border: 1px solid var(--gold); background: rgba(255,255,255,0.05); color: var(--gold); border-radius: 5px; outline: none; box-sizing: border-box; font-size: 16px; }
        .btn-scan { width: 100%; margin-top: 10px; padding: 15px; background: var(--gold); color: #000; border: none; font-weight: bold; cursor: pointer; text-transform: uppercase; }

        /* Card k·∫øt qu·∫£ n√¢ng cao */
        .card { display: none; background: #fff; color: #000; border-radius: 0; padding: 20px; max-width: 480px; margin: 20px auto; text-align: left; border: 3px solid var(--gold); box-shadow: 0 0 40px rgba(0,0,0,0.8); animation: slideIn 0.5s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .warning-strip { background: var(--red); color: #fff; padding: 8px; font-size: 11px; font-weight: bold; text-align: center; margin-bottom: 15px; }
        .price-box { background: #fdf2f2; border-left: 5px solid var(--red); padding: 15px; margin-bottom: 15px; }
        .price-box b { font-size: 26px; color: #d32f2f; }

        /* V√πng b·∫£n ƒë·ªì v·ªá tinh mini */
        .map-mini { width: 100%; height: 200px; background: #eee; margin: 15px 0; border: 1px solid #ddd; overflow: hidden; position: relative; }
        .map-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; flex-direction: column; align-items: center; justify-content: center; color: #fff; z-index: 5; text-align: center; padding: 20px; box-sizing: border-box; }
        
        /* QR v√† Thanh to√°n */
        .qr-section { background: #f4f7f9; border: 2px dashed #004e92; padding: 15px; text-align: center; cursor: pointer; }
        .qr-container { background: #fff; width: 200px; height: 200px; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; }
        .qr-img { width: 100%; height: 100%; }

        /* Th√¥ng b√°o sau thanh to√°n */
        .success-box { display: none; background: #e8f5e9; border: 2px solid var(--green); padding: 20px; margin-top: 15px; }
        .verified-stamp { border: 3px solid var(--green); color: var(--green); display: inline-block; padding: 5px 10px; font-weight: 900; transform: rotate(-15deg); margin-bottom: 10px; }

        #toast { position: fixed; top: 10px; right: 10px; background: var(--gold); color: #000; padding: 10px; font-size: 11px; font-weight: bold; display: none; z-index: 1000; }
    </style>
</head>
<body>

    <div class="header"><span class="live-dot"></span> SATELLITE RADAR CONNECTED: BA VI 2026</div>
    
    <div class="search-area">
        <input type="text" id="inp" placeholder="Nh·∫≠p Th√¥n/X√£/ƒê∆∞·ªùng tra c·ª©u...">
        <button class="btn-scan" onclick="startScan()">KH·ªûI CH·∫†Y QU√âT D·ªÆ LI·ªÜU</button>
    </div>

    <div id="res" class="card">
        <div class="warning-strip">‚ö†Ô∏è C·∫¢NH B√ÅO: D·ªÆ LI·ªÜU C√ì D·∫§U HI·ªÜU NGƒÇN CH·∫∂N QUY HO·∫†CH</div>
        <h2 id="rName" style="margin:0 0 10px 0; color: #1a237e;"></h2>
        
        <div class="price-box">
            <small>GI√Å ƒê·∫§T D·ª∞ B√ÅO QU√ù 1/2026:</small><br>
            <b id="rPrice"></b>
        </div>

        <div class="map-mini" id="mapBox">
            <div class="map-overlay" id="mapLock">
                <span style="font-size: 24px;">üîí</span>
                <p style="font-size: 12px; margin: 10px 0;">B·∫¢N ƒê·ªí V·ªÜ TINH CHI TI·∫æT ƒê√É B·ªä KH√ìA T·∫†I T·ªåA ƒê·ªò N√ÄY</p>
                <small style="font-size: 10px; color: var(--gold);">Vui l√≤ng thanh to√°n ph√≠ gi·∫£i m√£ ƒë·ªÉ xem v·ªã tr√≠ quy ho·∫°ch</small>
            </div>
            <iframe id="gMap" width="100%" height="100%" frameborder="0" style="border:0; display:none;" allowfullscreen></iframe>
        </div>

        <div class="qr-section" id="payZone" onclick="confirmPay()">
            <p style="margin:0 0 10px 0; font-size:13px; font-weight:bold; color:#0d47a1;">‚òï M·ªúI TR√Ä ƒê√Å 5K - M·ªû KH√ìA T·ªåA ƒê·ªò TH·∫¨T</p>
            <div class="qr-container">
                <img id="qrImg" class="qr-img" src="">
            </div>
            <div id="payStatus" style="font-size:11px; color:#f57c00; font-weight:bold;">‚åõ Ch·ªù t√≠n hi·ªáu t·ª´ ng√¢n h√†ng (M√£ ƒë·ªãnh danh: <span id="traceId"></span>)</div>
        </div>

        <div id="successBox" class="success-box">
            <div class="verified-stamp">X√ÅC TH·ª∞C 2026</div>
            <h3 style="color:#1b5e20; margin:0;">GI·∫¢I M√É TH√ÄNH C√îNG!</h3>
            <p style="font-size:12px; margin:10px 0;"><b>T·ªça ƒë·ªô VN-2000 tra c·ª©u:</b><br>
               <span id="finalToaDo" style="color:red; font-weight:bold; font-size:14px;"></span>
            </p>
            <p style="font-size:11px; line-height:1.4;">V·ªã tr√≠ khu ƒë·∫•t ƒë√£ ƒë∆∞·ª£c hi·ªÉn th·ªã tr√™n b·∫£n ƒë·ªì v·ªá tinh ph√≠a tr√™n. B·∫°n c√≥ th·ªÉ ph√≥ng to ƒë·ªÉ xem ranh gi·ªõi quy ho·∫°ch.</p>
            <a id="btnGoMap" target="_blank" style="display:block; text-align:center; background:#1a237e; color:#fff; padding:10px; text-decoration:none; border-radius:5px; font-size:12px; font-weight:bold; margin-top:10px;">üìç M·ªû V·ªä TR√ç TR√äN GOOGLE MAPS</a>
        </div>
        
        <button onclick="location.reload()" style="width:100%; background:#eee; border:none; padding:10px; margin-top:15px; cursor:pointer; font-weight:bold; color:#666;">D·ª™NG TRUY XU·∫§T</button>
    </div>

    <div id="toast">üîî <span id="msg"></span></div>

<script>
    const sTing = new Audio('https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3');
    const sScan = new Audio('https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3');
    let currentSearch = "";

    async function startScan() {
        const v = document.getElementById('inp').value; if(!v) return;
        currentSearch = v;
        sScan.play().catch(e => {});
        document.querySelector('.btn-scan').innerText = "üì° ƒêANG K·∫æT N·ªêI V·ªÜ TINH...";
        
        try {
            const r = await fetch('/api/search?q=' + encodeURIComponent(v));
            const d = await r.json();
            if(d.length > 0) {
                setTimeout(() => {
                    confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                    document.getElementById('rName').innerText = "üìç " + d[0].duong.toUpperCase();
                    document.getElementById('rPrice').innerText = d[0].gia_2026_du_kien.toLocaleString() + " VNƒê/m¬≤";
                    document.getElementById('traceId').innerText = "BV-" + Math.floor(Math.random()*90000 + 10000);
                    
                    // QR S·∫Øc n√©t - √âp PNG
                    const qImg = document.getElementById('qrImg');
                    const qLink = `https://img.vietqr.io/image/LPB-033963180001-compact.png?amount=5000&addInfo=MoKhoa%20${encodeURIComponent(d[0].duong)}&accountName=TRA%20CUU%20QUY%20HOACH`;
                    qImg.src = qLink;
                    
                    document.getElementById('res').style.display = 'block';
                    document.querySelector('.btn-scan').innerText = "KH·ªûI CH·∫†Y QU√âT D·ªÆ LI·ªÜU";
                }, 1200);
            } else { alert("Khu v·ª±c n√†y ch∆∞a c√≥ d·ªØ li·ªáu 2026!"); document.querySelector('.btn-scan').innerText = "KH·ªûI CH·∫†Y QU√âT D·ªÆ LI·ªÜU"; }
        } catch(e) { alert("L·ªói k·∫øt n·ªëi v·ªá tinh!"); }
    }

    function confirmPay() {
        const status = document.getElementById('payStatus');
        if(status.innerText.includes('X√ÅC TH·ª∞C')) return;

        status.innerHTML = "üì° ƒêang truy v·∫•n m√£ giao d·ªãch ng√¢n h√†ng...";
        setTimeout(() => {
            sTing.play().catch(e => {});
            confetti({ particleCount: 150, spread: 100, colors: ['#FFD700', '#2ecc71'] });
            
            // ·∫®n v√πng QR v√† hi·ªán SuccessBox
            document.getElementById('payZone').style.display = "none";
            document.getElementById('successBox').style.display = "block";
            
            // Hi·ªán B·∫£n ƒë·ªì th·∫≠t (S·ª≠ d·ª•ng t·ªça ƒë·ªô Ba V√¨)
            const mapLock = document.getElementById('mapLock');
            const gMap = document.getElementById('gMap');
            mapLock.style.display = "none";
            gMap.style.display = "block";
            
            // T·ªça ƒë·ªô gi·∫£ l·∫≠p nh∆∞ng kh·ªõp ƒë·ªãa ph∆∞∆°ng Ba V√¨
            const x = (593000 + Math.random()*2000).toFixed(0);
            const y = (2341000 + Math.random()*2000).toFixed(0);
            document.getElementById('finalToaDo').innerText = `X: ${x} - Y: ${y}`;
            
            // N·∫°p b·∫£n ƒë·ªì v·ªá tinh Ba V√¨ (S·ª≠ d·ª•ng Embed c·ªßa Google)
            const mapUrl = `https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d14885.641666710777!2d105.3789!3d21.1415!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e1!3m2!1svi!2s!4v1700000000000!5m2!1svi!2s&maptype=satellite`;
            gMap.src = mapUrl;

            // N√∫t m·ªü Google Maps th·∫≠t
            document.getElementById('btnGoMap').href = `https://www.google.com/maps/search/Ba+Vi+Hanoi/@21.1415,105.3789,15z/data=!3m1!1e3`;

        }, 3000);
    }

    // Ch·ªët ƒë∆°n ·∫£o
    setInterval(() => {
        const names = ["Anh H√πng (BƒêS)", "Ch·ªã Th·∫£o (ƒê·∫ßu t∆∞)", "VƒÉn Ph√≤ng Nh√† ƒê·∫•t", "Anh Tu·∫•n"];
        const areas = ["T√¢y ƒê·∫±ng", "V√¢n Sa", "C·ªï ƒê√¥", "Nhu·∫≠n Tr·∫°ch"];
        const t = document.getElementById('toast');
        document.getElementById('msg').innerText = names[Math.floor(Math.random()*4)] + " v·ª´a gi·∫£i m√£ quy ho·∫°ch t·∫°i " + areas[Math.floor(Math.random()*4)];
        t.style.display='block'; setTimeout(()=>t.style.display='none', 5000);
    }, 22000);
</script>
</body>
</html>
