<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BA VI LAND DATA - Hệ Thống Minh Bạch BĐS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --glass: rgba(255, 255, 255, 0.9); --primary: #0047AB; --accent: #FF8C00; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%); margin: 0; min-height: 100vh; display: flex; justify-content: center; padding: 20px; }
        .super-app { width: 100%; max-width: 480px; background: var(--glass); backdrop-filter: blur(10px); border-radius: 40px; box-shadow: 0 40px 100px rgba(0,0,0,0.1); overflow: hidden; }
        .hero { background: linear-gradient(to bottom, #0047AB, #002D62); padding: 40px 20px; text-align: center; color: white; border-radius: 0 0 40px 40px; }
        .search-container { padding: 0 25px; margin-top: -30px; }
        .search-card { background: white; padding: 10px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); display: flex; }
        .search-card input { flex: 1; border: none; outline: none; padding: 15px; font-weight: 600; font-size: 16px; }
        .btn-search { background: var(--accent); color: white; border: none; width: 50px; height: 50px; border-radius: 15px; cursor: pointer; transition: 0.3s; }
        #result-area { display: none; padding: 25px; animation: slideUp 0.5s ease; }
        @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .price-main { text-align: center; margin: 20px 0; }
        .price-main h2 { font-size: 38px; color: #D32F2F; margin: 5px 0; font-weight: 800; }
        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .data-item { background: #f8fafc; padding: 12px; border-radius: 15px; border: 1px solid #edf2f7; text-align: center; }
        .data-item small { color: #64748b; font-size: 10px; font-weight: 800; }
        .premium-zone { background: #FFF9F0; border: 2px dashed #FF8C00; border-radius: 25px; padding: 20px; text-align: center; }
        .qr-area img { width: 130px; border-radius: 15px; margin: 10px 0; border: 4px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .action-btns { display: flex; gap: 10px; margin-top: 20px; }
        .btn-action { flex: 1; padding: 14px; border-radius: 15px; text-decoration: none; font-weight: 700; color: white; text-align: center; font-size: 13px; }
    </style>
</head>
<body>

<div class="super-app">
    <div class="hero">
        <p style="font-size: 10px; font-weight: 800; opacity: 0.8; margin:0;">Hệ thống dữ liệu 31 xã</p>
        <h1 style="margin:5px 0 0 0; font-size: 26px;">BA VI LAND DATA</h1>
    </div>

    <div class="search-container">
        <div class="search-card">
            <input type="text" id="keyword" placeholder="Nhập Thôn/Xã (VD: Vân Sa)">
            <button class="btn-search" onclick="handleSearch()"><i class="fas fa-search"></i></button>
        </div>
    </div>

    <div id="result-area">
        <div style="text-align:center;"><span style="background:#e8f0fe; color:#0047ab; padding:5px 15px; border-radius:20px; font-size:10px; font-weight:800;">BÁO CÁO MIỄN PHÍ</span></div>
        <h3 id="loc-title" style="text-align:center; margin: 15px 0; font-size: 20px;">---</h3>
        
        <div class="price-main">
            <small style="font-weight: 600; color: #64748b;">Giá dự báo 2026</small>
            <h2 id="loc-price">0 đ</h2>
        </div>

        <div class="data-grid">
            <div class="data-item"><small>TIỀM NĂNG</small><div style="color:#27ae60; font-weight:700;">Rất Cao</div></div>
            <div class="data-item"><small>TRẠNG THÁI</small><div style="font-weight:700;">Đất Sạch</div></div>
        </div>

        <div class="premium-zone">
            <i class="fas fa-lock" style="color:#FF8C00;"></i>
            <p style="font-size: 13px; font-weight: 800; margin: 5px 0;">Mở khóa Quy hoạch & Tọa độ</p>
            <div class="qr-area">
                <img src="https://img.vietqr.io/image/LPB-033963180001-compact.jpg?amount=5000&addInfo=Mo%20khoa%20quy%20hoach&accountName=Ba%20Vi%20Land" alt="QR">
            </div>
            <p style="font-size: 10px; color:#64748b;">Mời tác giả ly trà đá 5.000đ để duy trì</p>
            <div style="font-size: 11px; font-weight: 800; color: #0047AB;">LP BANK: 033963180001</div>
        </div>

        <div class="action-btns">
            <a href="https://zalo.me/0368869160" class="btn-action" style="background:#0068FF;"><i class="fab fa-whatsapp"></i> Chat Zalo</a>
            <a href="tel:0368869160" class="btn-action" style="background:#27AE60;"><i class="fas fa-phone-alt"></i> Gọi Ký Gửi</a>
        </div>
    </div>
</div>

<script>
    function playSound() {
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.frequency.setValueAtTime(440, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.1);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
        osc.start(); osc.stop(audioCtx.currentTime + 0.3);
    }

   async function handleSearch() {
    const k = document.getElementById('keyword').value;
    const resArea = document.getElementById('result-area');
    
    if(!k) {
        alert("Vui lòng nhập tên thôn hoặc xã!");
        return;
    }

    try {
        // ĐÂY LÀ DÒNG QUAN TRỌNG NHẤT: Đã sửa thành /api/search
        const response = await fetch(`/api/search?q=${encodeURIComponent(k)}`);
        const data = await response.json();

        if(data.length > 0) {
            // 1. Hiển thị thông tin lên giao diện
            document.getElementById('loc-title').innerText = data[0].duong;
            document.getElementById('loc-price').innerText = data[0].gia_2026_du_kien.toLocaleString() + " đ/m²";
            resArea.style.display = 'block';
            
            // 2. Kích hoạt âm thanh vút lên (0KB)
            playSound();

            // 3. Bắn pháo hoa chúc mừng
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 },
                colors: ['#FFD700', '#0047AB', '#FF8C00']
            });

            // Cuộn xuống để xem kết quả mượt mà
            window.scrollTo({ top: 500, behavior: 'smooth' });
        } else {
            alert("Dữ liệu thôn này đang được cập nhật, vui lòng thử tên khác!");
        }
    } catch(e) {
        console.error("Lỗi kết nối:", e);
        alert("Không thể kết nối máy chủ. Hãy kiểm tra lại internet!");
    }
}
</script>
</body>
</html>